openapi: 3.0.3
info:
  title: Standard BE API
  version: 1.0.0
servers:
  - url: /api/v1

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    Role:
      type: string
      enum: [ GUEST, USER, ADMIN ]

    Provider:
      type: string
      enum: [ MANUAL, GOOGLE, APPLE, FACEBOOK, PASSCODE ]

    AuthTokens:
      type: object
      required: [ accessToken, expiresInSeconds, refreshToken, refreshExpiresInSeconds ]
      properties:
        accessToken: { type: string }
        expiresInSeconds: { type: integer, example: 900 }
        refreshToken: { type: string }
        refreshExpiresInSeconds: { type: integer, example: 5184000 }

    UserSummary:
      type: object
      required: [ id, role, provider, email ]
      properties:
        id: { type: string, format: uuid }
        email: { type: string, format: email }
        role: { $ref: '#/components/schemas/Role' }
        provider: { $ref: '#/components/schemas/Provider' }
        name: { type: string }
        avatarUrl: { type: string, format: uri }

    LoginRequest:
      type: object
      required: [ provider, email, password, device ]
      properties:
        provider: { $ref: '#/components/schemas/Provider' }
        email: { type: string, format: email }
        password: { type: string, minLength: 6 }
        device:
          $ref: '#/components/schemas/DeviceInfo'

    RegisterRequest:
      type: object
      required: [ email, password, device ]
      properties:
        email: { type: string, format: email }
        password: { type: string, minLength: 6 }
        device:
          $ref: '#/components/schemas/DeviceInfo'

    AdminPasscodeLoginRequest:
      type: object
      required: [ passcode, device ]
      properties:
        passcode: { type: string, minLength: 4 }
        device:
          $ref: '#/components/schemas/DeviceInfo'

    SocialLoginRequest:
      type: object
      required: [ provider, device ]
      properties:
        provider: { $ref: '#/components/schemas/Provider' }
        token: { type: string }
        device:
          $ref: '#/components/schemas/DeviceInfo'

    RefreshRequest:
      type: object
      required: [ refreshToken, deviceId ]
      properties:
        refreshToken: { type: string }
        deviceId: { type: string, maxLength: 128 }

    DeviceInfo:
      type: object
      required: [ deviceId, platform ]
      properties:
        deviceId: { type: string, maxLength: 128 }
        deviceName: { type: string, maxLength: 128 }
        platform: { type: string, enum: [ IOS, ANDROID, WEB ] }

    AuthResponse:
      type: object
      required: [ tokens, user ]
      properties:
        tokens: { $ref: '#/components/schemas/AuthTokens' }
        user: { $ref: '#/components/schemas/UserSummary' }

    PostStatus:
      type: string
      enum: [ DRAFT, PUBLISHED, ARCHIVED ]

    FeedItemType:
      type: string
      enum: [ POST, EVENT ]

    FeedItemStatus:
      type: string
      enum: [ DRAFT, PUBLISHED, ARCHIVED ]

    ImageRef:
      type: object
      required: [ url ]
      properties:
        url: { type: string }
        alt: { type: string }

    EmbedPlatform:
      type: string
      enum: [ youtube, vimeo ]

    SpotifyType:
      type: string
      enum: [ track, album, playlist, episode, show ]

    SplashMediaType:
      type: string
      enum: [ image, video ]

    SplashConfig:
      type: object
      required: [ enabled, mediaType, mediaUrl, duration, showCloseButton, closeButtonDelay ]
      properties:
        enabled: { type: boolean }
        mediaType: { $ref: '#/components/schemas/SplashMediaType' }
        mediaUrl: { type: string, nullable: true }
        duration: { type: integer, minimum: 0 }
        showCloseButton: { type: boolean }
        closeButtonDelay: { type: integer, minimum: 0 }

    AppConfig:
      type: object
      required: [ socialLoginEnabled, postsPerPage, splash ]
      properties:
        socialLoginEnabled: { type: boolean }
        postsPerPage: { type: integer, minimum: 5, maximum: 50 }
        splash: { $ref: '#/components/schemas/SplashConfig' }

    NavigationTab:
      type: object
      required: [ id, name, icon, order, enabled, isSystem ]
      properties:
        id: { type: string }
        name: { type: string }
        icon: { type: string }
        order: { type: integer }
        enabled: { type: boolean }
        isSystem: { type: boolean }

    NavigationConfig:
      type: object
      required: [ tabs ]
      properties:
        tabs:
          type: array
          items: { $ref: '#/components/schemas/NavigationTab' }

    BlockType:
      type: string
      enum: [ paragraph, heading, image, quote, video, embed, gallery, link, spotify ]

    Block:
      type: object
      required: [ type ]
      properties:
        type:
          $ref: '#/components/schemas/BlockType'
      discriminator:
        propertyName: type
        mapping:
          paragraph: '#/components/schemas/ParagraphBlock'
          heading: '#/components/schemas/HeadingBlock'
          image: '#/components/schemas/ImageBlock'
          quote: '#/components/schemas/QuoteBlock'
          video: '#/components/schemas/VideoBlock'
          embed: '#/components/schemas/EmbedBlock'
          gallery: '#/components/schemas/GalleryBlock'
          link: '#/components/schemas/LinkBlock'
          spotify: '#/components/schemas/SpotifyBlock'

    ParagraphBlock:
      allOf:
        - $ref: '#/components/schemas/Block'
        - type: object
          required: [ text ]
          properties:
            text:
              type: string
            html:
              type: string

    HeadingBlock:
      allOf:
        - $ref: '#/components/schemas/Block'
        - type: object
          required: [ level, text ]
          properties:
            level:
              type: integer
              minimum: 1
              maximum: 6
            text:
              type: string

    ImageBlock:
      allOf:
        - $ref: '#/components/schemas/Block'
        - type: object
          required: [ image ]
          properties:
            image:
              $ref: '#/components/schemas/ImageRef'

    QuoteBlock:
      allOf:
        - $ref: '#/components/schemas/Block'
        - type: object
          required: [ text ]
          properties:
            text:
              type: string
            author:
              type: string

    VideoBlock:
      allOf:
        - $ref: '#/components/schemas/Block'
        - type: object
          required: [ url ]
          properties:
            url: { type: string }
            poster: { type: string }

    EmbedBlock:
      allOf:
        - $ref: '#/components/schemas/Block'
        - type: object
          required: [ platform, id ]
          properties:
            platform: { $ref: '#/components/schemas/EmbedPlatform' }
            id: { type: string }

    GalleryBlock:
      allOf:
        - $ref: '#/components/schemas/Block'
        - type: object
          required: [ urls ]
          properties:
            urls:
              type: array
              items: { type: string }

    LinkBlock:
      allOf:
        - $ref: '#/components/schemas/Block'
        - type: object
          required: [ url ]
          properties:
            url: { type: string }
            title: { type: string }
            description: { type: string }

    SpotifyBlock:
      allOf:
        - $ref: '#/components/schemas/Block'
        - type: object
          required: [ url, spotifyType, spotifyId ]
          properties:
            url: { type: string }
            spotifyType: { $ref: '#/components/schemas/SpotifyType' }
            spotifyId: { type: string }

    PostSummary:
      type: object
      required: [ id, title, slug, status, tags ]
      properties:
        id: { type: string, format: uuid }
        title: { type: string }
        slug: { type: string }
        excerpt: { type: string }
        tags:
          type: array
          items: { type: string }
        status: { $ref: '#/components/schemas/PostStatus' }
        thumbnail: { $ref: '#/components/schemas/ImageRef' }
        publishedAt: { type: string, format: date-time }
        date: { type: string, nullable: true }
        duration: { type: string, nullable: true }

    PostDetails:
      type: object
      required: [ id, title, slug, status, tags, content ]
      properties:
        id: { type: string, format: uuid }
        title: { type: string }
        slug: { type: string }
        excerpt: { type: string }
        tags:
          type: array
          items: { type: string }
        status: { $ref: '#/components/schemas/PostStatus' }
        thumbnail: { $ref: '#/components/schemas/ImageRef' }
        content:
          type: array
          items: { $ref: '#/components/schemas/Block' }
        publishedAt: { type: string, format: date-time }
        date: { type: string, nullable: true }
        duration: { type: string, nullable: true }
        createdAt: { type: string, format: date-time }
        updatedAt: { type: string, format: date-time }
        createdBy: { type: string }

    FeedItemSummary:
      type: object
      required: [ type, id, title, slug, status, tags ]
      properties:
        type: { $ref: '#/components/schemas/FeedItemType' }
        id: { type: string, format: uuid }
        title: { type: string }
        slug: { type: string }
        excerpt: { type: string }
        tags:
          type: array
          items: { type: string }
        status: { $ref: '#/components/schemas/FeedItemStatus' }
        thumbnail: { $ref: '#/components/schemas/ImageRef' }
        publishedAt: { type: string, format: date-time }
        startAt: { type: string, format: date-time }
        endAt: { type: string, format: date-time }
        timezone: { type: string }
        location: { type: string }
        ticketsUrl: { type: string }
        createdAt: { type: string, format: date-time }
        updatedAt: { type: string, format: date-time }
        createdBy: { type: string, format: uuid }

    EventStatus:
      type: string
      enum: [ DRAFT, PUBLISHED, ARCHIVED ]

    EventSummary:
      type: object
      required: [ id, title, slug, status, tags ]
      properties:
        id: { type: string, format: uuid }
        title: { type: string }
        slug: { type: string }
        excerpt: { type: string }
        tags:
          type: array
          items: { type: string }
        status: { $ref: '#/components/schemas/EventStatus' }
        thumbnail: { $ref: '#/components/schemas/ImageRef' }
        startAt: { type: string, format: date-time }
        endAt: { type: string, format: date-time }
        timezone: { type: string }
        location: { type: string }
        ticketsUrl: { type: string }
        createdAt: { type: string, format: date-time }
        updatedAt: { type: string, format: date-time }
        createdBy: { type: string, format: uuid }

    EventDetails:
      allOf:
        - $ref: '#/components/schemas/EventSummary'
        - type: object
          required: [ content ]
          properties:
            content:
              type: array
              items: { $ref: '#/components/schemas/Block' }

    PageEventSummary:
      type: object
      required: [ items, page, size ]
      properties:
        items:
          type: array
          items: { $ref: '#/components/schemas/EventSummary' }
        page: { type: integer }
        size: { type: integer }
        totalItems: { type: integer }

    PagePostSummary:
      type: object
      required: [ items, page, size ]
      properties:
        items:
          type: array
          items: { $ref: '#/components/schemas/PostSummary' }
        page: { type: integer }
        size: { type: integer }
        totalItems: { type: integer }

    PageFeedItemSummary:
      type: object
      required: [ items, page, size ]
      properties:
        items:
          type: array
          items: { $ref: '#/components/schemas/FeedItemSummary' }
        page: { type: integer }
        size: { type: integer }
        totalItems: { type: integer }

    PodcastImportItem:
      type: object
      required: [ title ]
      properties:
        title: { type: string }
        description: { type: string }
        date: { type: string }
        duration: { type: string, nullable: true }
        url: { type: string }
        youtube_id: { type: string, nullable: true }
        youtube_url: { type: string, nullable: true }
        thumbnail: { type: string, nullable: true }

    ImportPostsRequest:
      type: object
      required: [ items ]
      properties:
        items:
          type: array
          items: { $ref: '#/components/schemas/PodcastImportItem' }

    CreatePostRequest:
      type: object
      required: [ title, slug, content ]
      properties:
        title: { type: string }
        slug: { type: string }
        excerpt: { type: string }
        tags:
          type: array
          items: { type: string }
        thumbnail: { $ref: '#/components/schemas/ImageRef' }
        content:
          type: array
          items: { $ref: '#/components/schemas/Block' }
        date: { type: string, nullable: true }
        duration: { type: string, nullable: true }

    UpdatePostRequest:
      allOf:
        - $ref: '#/components/schemas/CreatePostRequest'

    CreateEventRequest:
      type: object
      required: [ title, slug, content ]
      properties:
        title: { type: string }
        slug: { type: string }
        excerpt: { type: string }
        tags:
          type: array
          items: { type: string }
        thumbnail: { $ref: '#/components/schemas/ImageRef' }
        content:
          type: array
          items: { $ref: '#/components/schemas/Block' }
        startAt: { type: string, format: date-time }
        endAt: { type: string, format: date-time }
        timezone: { type: string }
        location: { type: string }
        ticketsUrl: { type: string }

    UpdateEventRequest:
      allOf:
        - $ref: '#/components/schemas/CreateEventRequest'

    ImportEventsRequest:
      type: object
      required: [ items ]
      properties:
        items:
          type: array
          items: { $ref: '#/components/schemas/CreateEventRequest' }

paths:
  /public/auth/register:
    post:
      tags: [ PublicAuth ]
      operationId: publicAuthRegister
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/RegisterRequest' }
      responses:
        "200":
          description: Registered
          content:
            application/json:
              schema: { $ref: '#/components/schemas/AuthResponse' }

  /public/auth/login:
    post:
      tags: [ PublicAuth ]
      operationId: publicAuthLogin
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/LoginRequest' }
      responses:
        "200":
          description: Logged in
          content:
            application/json:
              schema: { $ref: '#/components/schemas/AuthResponse' }

  /public/auth/admin-passcode:
    post:
      tags: [ PublicAuth ]
      operationId: publicAuthAdminPasscode
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/AdminPasscodeLoginRequest' }
      responses:
        "200":
          description: Logged in
          content:
            application/json:
              schema: { $ref: '#/components/schemas/AuthResponse' }

  /public/auth/social:
    post:
      tags: [ PublicAuth ]
      operationId: publicAuthSocial
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/SocialLoginRequest' }
      responses:
        "200":
          description: Logged in
          content:
            application/json:
              schema: { $ref: '#/components/schemas/AuthResponse' }

  /public/auth/refresh:
    post:
      tags: [ PublicAuth ]
      operationId: publicAuthRefresh
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/RefreshRequest' }
      responses:
        "200":
          description: Refreshed
          content:
            application/json:
              schema: { $ref: '#/components/schemas/AuthResponse' }

  /public/auth/logout:
    post:
      tags: [ PublicAuth ]
      operationId: publicAuthLogout
      security:
        - bearerAuth: [ ]
      responses:
        "204":
          description: Logged out

  /public/feed:
    get:
      tags: [ PublicFeed ]
      operationId: publicFeedList
      parameters:
        - in: query
          name: page
          schema: { type: integer, default: 0 }
        - in: query
          name: size
          schema: { type: integer, default: 20, minimum: 1, maximum: 50 }
      responses:
        "200":
          description: Feed page
          content:
            application/json:
              schema: { $ref: '#/components/schemas/PageFeedItemSummary' }

  /public/posts/{slug}:
    get:
      tags: [ PublicFeed ]
      operationId: publicPostGetBySlug
      parameters:
        - in: path
          name: slug
          required: true
          schema: { type: string }
      responses:
        "200":
          description: Post details
          content:
            application/json:
              schema: { $ref: '#/components/schemas/PostDetails' }

  /public/events:
    get:
      tags: [ PublicEvents ]
      operationId: publicEventsList
      parameters:
        - in: query
          name: page
          schema: { type: integer, default: 0 }
        - in: query
          name: size
          schema: { type: integer, default: 20, minimum: 1, maximum: 50 }
      responses:
        "200":
          description: Events page
          content:
            application/json:
              schema: { $ref: '#/components/schemas/PageEventSummary' }

  /public/events/{slug}:
    get:
      tags: [ PublicEvents ]
      operationId: publicEventGetBySlug
      parameters:
        - in: path
          name: slug
          required: true
          schema: { type: string }
      responses:
        "200":
          description: Event details
          content:
            application/json:
              schema: { $ref: '#/components/schemas/EventDetails' }

  /public/app-config:
    get:
      tags: [ PublicConfig ]
      operationId: publicAppConfig
      responses:
        "200":
          description: Public app configuration
          content:
            application/json:
              schema: { $ref: '#/components/schemas/AppConfig' }

  /admin/app-config:
    get:
      tags: [ AdminConfig ]
      operationId: adminAppConfigGet
      security:
        - bearerAuth: [ ]
      responses:
        "200":
          description: Admin app configuration
          content:
            application/json:
              schema: { $ref: '#/components/schemas/AppConfig' }
    put:
      tags: [ AdminConfig ]
      operationId: adminAppConfigUpdate
      security:
        - bearerAuth: [ ]
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/AppConfig' }
      responses:
        "200":
          description: Updated
          content:
            application/json:
              schema: { $ref: '#/components/schemas/AppConfig' }

  /public/navigation-config:
    get:
      tags: [ PublicNavigationConfig ]
      operationId: publicNavigationConfigGet
      responses:
        "200":
          description: Public navigation configuration
          content:
            application/json:
              schema: { $ref: '#/components/schemas/NavigationConfig' }

  /admin/navigation-config:
    put:
      tags: [ AdminNavigationConfig ]
      operationId: adminNavigationConfigUpdate
      security:
        - bearerAuth: [ ]
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/NavigationConfig' }
      responses:
        "200":
          description: Updated
          content:
            application/json:
              schema: { $ref: '#/components/schemas/NavigationConfig' }

  /admin/posts:
    get:
      tags: [ AdminPosts ]
      operationId: adminPostList
      security:
        - bearerAuth: [ ]
      parameters:
        - in: query
          name: page
          schema: { type: integer, default: 0 }
        - in: query
          name: size
          schema: { type: integer, default: 20, minimum: 1, maximum: 50 }
        - in: query
          name: status
          schema: { $ref: '#/components/schemas/PostStatus' }
      responses:
        "200":
          description: Admin post page
          content:
            application/json:
              schema: { $ref: '#/components/schemas/PagePostSummary' }
    post:
      tags: [ AdminPosts ]
      operationId: adminPostCreate
      security:
        - bearerAuth: [ ]
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/CreatePostRequest' }
      responses:
        "201":
          description: Created draft
          content:
            application/json:
              schema: { $ref: '#/components/schemas/PostDetails' }

  /admin/events:
    get:
      tags: [ AdminEvents ]
      operationId: adminEventList
      security:
        - bearerAuth: [ ]
      parameters:
        - in: query
          name: page
          schema: { type: integer, default: 0 }
        - in: query
          name: size
          schema: { type: integer, default: 20, minimum: 1, maximum: 50 }
        - in: query
          name: status
          schema: { $ref: '#/components/schemas/EventStatus' }
      responses:
        "200":
          description: Admin event page
          content:
            application/json:
              schema: { $ref: '#/components/schemas/PageEventSummary' }
    post:
      tags: [ AdminEvents ]
      operationId: adminEventCreate
      security:
        - bearerAuth: [ ]
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/CreateEventRequest' }
      responses:
        "201":
          description: Created draft
          content:
            application/json:
              schema: { $ref: '#/components/schemas/EventDetails' }

  /admin/posts/{id}:
    get:
      tags: [ AdminPosts ]
      operationId: adminPostGet
      security:
        - bearerAuth: [ ]
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string, format: uuid }
      responses:
        "200":
          description: Post details
          content:
            application/json:
              schema: { $ref: '#/components/schemas/PostDetails' }
    put:
      tags: [ AdminPosts ]
      operationId: adminPostUpdate
      security:
        - bearerAuth: [ ]
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string, format: uuid }
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/UpdatePostRequest' }
      responses:
        "200":
          description: Updated
          content:
            application/json:
              schema: { $ref: '#/components/schemas/PostDetails' }
    delete:
      tags: [ AdminPosts ]
      operationId: adminPostDelete
      security:
        - bearerAuth: [ ]
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string, format: uuid }
      responses:
        "204":
          description: Deleted

  /admin/events/{id}:
    get:
      tags: [ AdminEvents ]
      operationId: adminEventGet
      security:
        - bearerAuth: [ ]
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string, format: uuid }
      responses:
        "200":
          description: Event details
          content:
            application/json:
              schema: { $ref: '#/components/schemas/EventDetails' }
    put:
      tags: [ AdminEvents ]
      operationId: adminEventUpdate
      security:
        - bearerAuth: [ ]
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string, format: uuid }
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/UpdateEventRequest' }
      responses:
        "200":
          description: Updated
          content:
            application/json:
              schema: { $ref: '#/components/schemas/EventDetails' }
    delete:
      tags: [ AdminEvents ]
      operationId: adminEventDelete
      security:
        - bearerAuth: [ ]
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string, format: uuid }
      responses:
        "204":
          description: Deleted

  /admin/posts/{id}/publish:
    post:
      tags: [ AdminPosts ]
      operationId: adminPostPublish
      security:
        - bearerAuth: [ ]
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string, format: uuid }
      responses:
        "200":
          description: Published
          content:
            application/json:
              schema: { $ref: '#/components/schemas/PostDetails' }

  /admin/events/{id}/publish:
    post:
      tags: [ AdminEvents ]
      operationId: adminEventPublish
      security:
        - bearerAuth: [ ]
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string, format: uuid }
      responses:
        "200":
          description: Published
          content:
            application/json:
              schema: { $ref: '#/components/schemas/EventDetails' }

  /admin/posts/import:
    post:
      tags: [ AdminPosts ]
      operationId: adminPostImport
      security:
        - bearerAuth: [ ]
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/ImportPostsRequest' }
      responses:
        "200":
          description: Imported
          content:
            application/json:
              schema:
                type: array
                items: { $ref: '#/components/schemas/PostSummary' }

  /admin/events/import:
    post:
      tags: [ AdminEvents ]
      operationId: adminEventImport
      security:
        - bearerAuth: [ ]
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/ImportEventsRequest' }
      responses:
        "200":
          description: Imported
          content:
            application/json:
              schema:
                type: array
                items: { $ref: '#/components/schemas/EventSummary' }

  /admin/posts/reset:
    post:
      tags: [ AdminPosts ]
      operationId: adminPostReset
      security:
        - bearerAuth: [ ]
      responses:
        "204":
          description: Reset complete

  /admin/events/reset:
    post:
      tags: [ AdminEvents ]
      operationId: adminEventReset
      security:
        - bearerAuth: [ ]
      responses:
        "204":
          description: Reset complete
